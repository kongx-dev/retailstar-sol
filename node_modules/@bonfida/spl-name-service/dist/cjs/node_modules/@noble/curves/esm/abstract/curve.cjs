"use strict";var e=require("./modular.cjs"),t=require("./utils.cjs");
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const n=BigInt(0),r=BigInt(1);function i(e,t){const n=t.negate();return e?n:t}function o(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function s(e,n){o(e,n);const r=2**e;return{windows:Math.ceil(n/e)+1,windowSize:2**(e-1),mask:t.bitMask(e),maxNumber:r,shiftBy:BigInt(e)}}function a(e,t,n){const{windowSize:i,mask:o,maxNumber:s,shiftBy:a}=n;let f=Number(e&o),d=e>>a;f>i&&(f-=s,d+=r);const c=t*i;return{nextN:d,offset:c+Math.abs(f)-1,isZero:0===f,isNeg:f<0,isNegF:t%2!=0,offsetF:c}}const f=new WeakMap,d=new WeakMap;function c(e){return d.get(e)||1}exports.pippenger=function(e,n,r,i){!function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach(((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)}))}(r,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach(((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)}))}(i,n);const o=r.length,s=i.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");const a=e.ZERO,f=t.bitLen(BigInt(o));let d=1;f>12?d=f-3:f>4?d=f-2:f>0&&(d=2);const c=t.bitMask(d),u=new Array(Number(c)+1).fill(a);let l=a;for(let e=Math.floor((n.BITS-1)/d)*d;e>=0;e-=d){u.fill(a);for(let t=0;t<s;t++){const n=i[t],o=Number(n>>BigInt(e)&c);u[o]=u[o].add(r[t])}let t=a;for(let e=u.length-1,n=a;e>0;e--)n=n.add(u[e]),t=t.add(n);if(l=l.add(t),0!==e)for(let e=0;e<d;e++)l=l.double()}return l},exports.validateBasic=function(n){return e.validateField(n.Fp),t.validateObject(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...e.nLength(n.n,n.nBitLength),...n,p:n.Fp.ORDER})},exports.wNAF=function(e,t){return{constTimeNegate:i,hasPrecomputes:e=>1!==c(e),unsafeLadder(t,i,o=e.ZERO){let s=t;for(;i>n;)i&r&&(o=o.add(s)),s=s.double(),i>>=r;return o},precomputeWindow(e,n){const{windows:r,windowSize:i}=s(n,t),o=[];let a=e,f=a;for(let e=0;e<r;e++){f=a,o.push(f);for(let e=1;e<i;e++)f=f.add(a),o.push(f);a=f.double()}return o},wNAF(n,r,o){let f=e.ZERO,d=e.BASE;const c=s(n,t);for(let e=0;e<c.windows;e++){const{nextN:t,offset:n,isZero:s,isNeg:u,isNegF:l,offsetF:w}=a(o,e,c);o=t,s?d=d.add(i(l,r[w])):f=f.add(i(u,r[n]))}return{p:f,f:d}},wNAFUnsafe(r,i,o,f=e.ZERO){const d=s(r,t);for(let e=0;e<d.windows&&o!==n;e++){const{nextN:t,offset:n,isZero:r,isNeg:s}=a(o,e,d);if(o=t,!r){const e=i[n];f=f.add(s?e.negate():e)}}return f},getPrecomputes(e,t,n){let r=f.get(t);return r||(r=this.precomputeWindow(t,e),1!==e&&f.set(t,n(r))),r},wNAFCached(e,t,n){const r=c(e);return this.wNAF(r,this.getPrecomputes(r,e,n),t)},wNAFCachedUnsafe(e,t,n,r){const i=c(e);return 1===i?this.unsafeLadder(e,t,r):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,r)},setWindowSize(e,n){o(n,t),d.set(e,n),f.delete(e)}}};
//# sourceMappingURL=curve.cjs.map
