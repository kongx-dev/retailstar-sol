import{validateField as e,nLength as t}from"./modular.mjs";import{validateObject as n,bitLen as r,bitMask as o}from"./utils.mjs";
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const i=BigInt(0),s=BigInt(1);function a(e,t){const n=t.negate();return e?n:t}function f(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function d(e,t){f(e,t);const n=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:o(e),maxNumber:n,shiftBy:BigInt(e)}}function c(e,t,n){const{windowSize:r,mask:o,maxNumber:i,shiftBy:a}=n;let f=Number(e&o),d=e>>a;f>r&&(f-=i,d+=s);const c=t*r;return{nextN:d,offset:c+Math.abs(f)-1,isZero:0===f,isNeg:f<0,isNegF:t%2!=0,offsetF:c}}const u=new WeakMap,l=new WeakMap;function w(e){return l.get(e)||1}function h(e,t){return{constTimeNegate:a,hasPrecomputes:e=>1!==w(e),unsafeLadder(t,n,r=e.ZERO){let o=t;for(;n>i;)n&s&&(r=r.add(o)),o=o.double(),n>>=s;return r},precomputeWindow(e,n){const{windows:r,windowSize:o}=d(n,t),i=[];let s=e,a=s;for(let e=0;e<r;e++){a=s,i.push(a);for(let e=1;e<o;e++)a=a.add(s),i.push(a);s=a.double()}return i},wNAF(n,r,o){let i=e.ZERO,s=e.BASE;const f=d(n,t);for(let e=0;e<f.windows;e++){const{nextN:t,offset:n,isZero:d,isNeg:u,isNegF:l,offsetF:w}=c(o,e,f);o=t,d?s=s.add(a(l,r[w])):i=i.add(a(u,r[n]))}return{p:i,f:s}},wNAFUnsafe(n,r,o,s=e.ZERO){const a=d(n,t);for(let e=0;e<a.windows&&o!==i;e++){const{nextN:t,offset:n,isZero:i,isNeg:f}=c(o,e,a);if(o=t,!i){const e=r[n];s=s.add(f?e.negate():e)}}return s},getPrecomputes(e,t,n){let r=u.get(t);return r||(r=this.precomputeWindow(t,e),1!==e&&u.set(t,n(r))),r},wNAFCached(e,t,n){const r=w(e);return this.wNAF(r,this.getPrecomputes(r,e,n),t)},wNAFCachedUnsafe(e,t,n,r){const o=w(e);return 1===o?this.unsafeLadder(e,t,r):this.wNAFUnsafe(o,this.getPrecomputes(o,e,n),t,r)},setWindowSize(e,n){f(n,t),l.set(e,n),u.delete(e)}}}function g(e,t,n,i){!function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach(((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)}))}(n,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach(((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)}))}(i,t);const s=n.length,a=i.length;if(s!==a)throw new Error("arrays of points and scalars must have equal length");const f=e.ZERO,d=r(BigInt(s));let c=1;d>12?c=d-3:d>4?c=d-2:d>0&&(c=2);const u=o(c),l=new Array(Number(u)+1).fill(f);let w=f;for(let e=Math.floor((t.BITS-1)/c)*c;e>=0;e-=c){l.fill(f);for(let t=0;t<a;t++){const r=i[t],o=Number(r>>BigInt(e)&u);l[o]=l[o].add(n[t])}let t=f;for(let e=l.length-1,n=f;e>0;e--)n=n.add(l[e]),t=t.add(n);if(w=w.add(t),0!==e)for(let e=0;e<c;e++)w=w.double()}return w}function m(r){return e(r.Fp),n(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...t(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}export{g as pippenger,m as validateBasic,h as wNAF};
//# sourceMappingURL=curve.mjs.map
